%%

clear;

%%

load('/Users/benjaminchinlocal/Dropbox (Aguirre-Brainard Lab)/CNSC_data/ColorTrackingTask/LS2/KAS/LS2_TRK_jburge-hubel_CGB_KAS_001.mat');
MaxContrastLMS = unique(S.MaxContrastLMS,'rows');

colorDirections = round(atand(MaxContrastLMS(:,3)./MaxContrastLMS(:,1)));
colorDirectionsUnq = unique(colorDirections);
% colorDirectionsUnq = colorDirectionsUnq([4 5 6 3 2 1]);

colorCodes = [0.99 0.6 0.91; ...
              0.99 0.71 0.17; ...
              0.13 0.55 0.64; ...
              0.9 0.67 0.7; ...
              0.76 0.67 0.99; ...
              0.14 0.82 0.79];         
           
 %%
 
 alphaW = 70;
 betaW = -2;
 minLag = 0.3;
 amp = 0.5;
 
m = alphaW.*MaxContrastLMS(:,1)+betaW.*MaxContrastLMS(:,3);
lagModel = amp*exp(-m)+minLag;

legendLS = {};

figure;
set(gcf,'Position',[337 320 1224 486]);
subplot(1,2,1);
hold on;
for i = 1:length(colorDirectionsUnq)
    ind = abs(colorDirections-colorDirectionsUnq(i))<0.01;
    plot(sqrt(sum(MaxContrastLMS(ind,:).^2,2)),lagModel(ind),'Color',colorCodes(i,:),'LineWidth',2);
    legendLS{i} = num2str(colorDirectionsUnq(i));
end
axis square;
formatFigure('Contrast','Lag (s)',['w_{L} = ' num2str(alphaW) ' w_{S} = ' num2str(betaW)]);
set(gca,'Xscale','log');
legend(legendLS,'Location','NorthEastOutside');

subplot(1,2,2);
hold on;
for i = 1:length(colorDirectionsUnq)
    ind = abs(colorDirections-colorDirectionsUnq(i))<0.01;
    plot(sqrt(sum(MaxContrastLMS(ind,:).^2,2)),m(ind),'Color',colorCodes(i,:),'LineWidth',2);
    legendLS{i} = num2str(colorDirectionsUnq(i));
end
axis square;
formatFigure('Contrast','M output');
set(gca,'Xscale','lin');
legend(legendLS,'Location','NorthEastOutside');

% %%
% 
% MaxContrastLMS = ...
%     [0.1800         0         0; ...
%      0.1160         0         0; ...
%      0.0747         0         0; ...
%      0.0482         0         0; ...
%      0.0310         0         0; ...
%      0.0200         0         0; ...
%      0.0000         0    0.8500; ...
%      0.0000         0    0.6231; ...
%      0.0000         0    0.4568; ...
%      0.0000         0    0.3349; ...
%      0.0000         0    0.2455; ...
%      0.0000         0    0.1800; ...
%      0.1682         0    0.6279; ...
%      0.1045         0    0.3899; ...
%      0.0649         0    0.2421; ...
%      0.0403         0    0.1503; ...
%      0.0250         0    0.0933; ...
%      0.0155         0    0.0580; ...
%      0.2019         0   -0.7534; ...
%      0.1209         0   -0.4511; ...
%      0.0724         0   -0.2701; ...
%      0.0433         0   -0.1617; ...
%      0.0259         0   -0.0968; ...
%      0.0155         0   -0.0580; ...
%      0.1768         0    0.1768; ...
%      0.1157         0    0.1157; ...
%      0.0757         0    0.0757; ...
%      0.0495         0    0.0495; ...
%      0.0324         0    0.0324; ...
%      0.0212         0    0.0212; ...
%      0.1838         0   -0.1838; ...
%      0.1194         0   -0.1194; ...
%      0.0775         0   -0.0775; ...
%      0.0503         0   -0.0503; ...
%      0.0327         0   -0.0327; ...
%      0.0212         0   -0.0212];
%  
%  colorDirections = round(atand(MaxContrastLMS(:,3)./MaxContrastLMS(:,1)));
%  colorDirectionsUnq = unique(colorDirections);
%  
%  colorCodes = [0.99 0.71 0.17; ...
%                0.14 0.82 0.79; ...
%                0.9 0.67 0.7; ...
%                0.13 0.55 0.64; ...
%                0.99 0.6 0.91; ...
%                0.76 0.67 0.99];
